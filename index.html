<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON to XSD Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
        }
        h1, h2 {
            color: #333;
        }
        textarea, input, pre {
            width: 80%;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            font-family: monospace;
        }
        textarea {
            height: 200px;
        }
        pre {
            background-color: #fff;
            height: 300px;
            overflow: auto;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            color: #fff;
            background-color: #007BFF;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
    <script>
        function generateXSD() {
            const jsonInput = document.getElementById("jsonInput").value;
            const targetNamespace = document.getElementById("targetNamespace").value;
            const rootElementName = document.getElementById("rootElementName").value;

            try {
                const jsonObject = JSON.parse(jsonInput);
                const xsd = generateXsdFromJson(jsonObject, targetNamespace, rootElementName);

                const formattedXsd = formatXml(xsd);
                document.getElementById("output").value = formattedXsd;
            } catch (e) {
                document.getElementById("output").value = "Invalid JSON input";
            }
        }

        function generateXsdFromJson(jsonObject, targetNamespace, rootElementName) {
            let xsd = '<?xml version="1.0" encoding="UTF-8"?>';
            xsd += `<xsd:schema targetNamespace="${targetNamespace}" xmlns="${targetNamespace}" xmlns:xsd="http://www.w3.org/2001/XMLSchema">`;
            xsd += `<xsd:element name="${rootElementName}">`;
            xsd += generateXsdElementsFromJson(jsonObject, true);
            xsd += `</xsd:element>`;
            xsd += '</xsd:schema>';
            return xsd;
        }

        function generateXsdElementsFromJson(jsonObject, isRoot = false) {
            let xsd = `<xsd:complexType${isRoot ? ` name="${document.getElementById('rootElementName').value}"` : ''}>`;
            xsd += `<xsd:sequence>`;
            for (let key in jsonObject) {
                if (!jsonObject.hasOwnProperty(key)) continue;
                if (jsonObject[key] === null || typeof jsonObject[key] !== 'object') {
                    let type = 'xsd:string';
                    let maxOccurs = '1';
                    if (Array.isArray(jsonObject[key])) {
                        maxOccurs = 'unbounded';
                        xsd += `<xsd:element name="${key}" type="${type}" minOccurs="0" maxOccurs="${maxOccurs}"/>`;
                    } else {
                        xsd += `<xsd:element name="${key}" type="${type}" minOccurs="0" maxOccurs="1"/>`;
                    }
                } else if (Array.isArray(jsonObject[key])) {
                    if (typeof jsonObject[key][0] === 'object') {
                        xsd += `<xsd:element name="${key}" minOccurs="0" maxOccurs="unbounded">`;
                        xsd += generateXsdElementsFromJson(jsonObject[key][0]);
                        xsd += `</xsd:element>`;
                    } else {
                        xsd += `<xsd:element name="${key}" type="xsd:string" minOccurs="0" maxOccurs="unbounded"/>`;
                    }
                } else {
                    xsd += `<xsd:element name="${key}" minOccurs="0" maxOccurs="1">`;
                    xsd += generateXsdElementsFromJson(jsonObject[key]);
                    xsd += `</xsd:element>`;
                }
            }
            xsd += `</xsd:sequence>`;
            xsd += `</xsd:complexType>`;
            return xsd;
        }

        function formatXml(xml) {
            const PADDING = ' '.repeat(2); // set desired indentation level
            const reg = /(>)(<)(\/*)/g;
            let pad = 0;
            xml = xml.replace(reg, '$1\r\n$2$3');
            return xml.split('\r\n').map((node) => {
                let indent = 0;
                if (node.match(/.+<\/\w[^>]*>$/)) {
                    indent = 0;
                } else if (node.match(/^<\/\w/) && pad !== 0) {
                    pad -= 1;
                } else if (node.match(/^<\w[^>]*[^\/]>.*$/)) {
                    indent = 1;
                } else {
                    indent = 0;
                }
                pad += indent;
                return PADDING.repeat(pad - indent) + node;
            }).join('\r\n');
        }

        function downloadXSD() {
            const xsd = document.getElementById("output").value;
            const blob = new Blob([xsd], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dt.xsd';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</head>
<body>
    <h1>JSON to XSD Generator</h1>
    <input type="text" id="targetNamespace" placeholder="Enter target namespace..." />
    <input type="text" id="rootElementName" placeholder="Enter root element name..." />
    <textarea id="jsonInput" placeholder='Enter JSON here...'></textarea><br>
    <button onclick="generateXSD()">Generate Now</button>
    <h2>Generated XSD:</h2>
    <textarea id="output" readonly></textarea><br>
    <button onclick="downloadXSD()">Download XSD</button>
</body>
</html>
